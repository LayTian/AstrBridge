# 毕业设计（论文）开题报告

## 一、课题名称
面向 AstrBot 的消息接入网关与管理平台（AstrBridge）的设计与实现

## 二、研究背景
对话式 AI 与机器人平台在校园服务、企业客服、信息检索与业务自动化中已成为常见基础设施。实际落地时，消息入口往往来自多端：浏览器端实时会话、业务系统的 HTTP 调用、Webhook 回调等。若缺少统一接入层，系统容易出现以下问题：
- 接入方式分散、协议与数据结构不统一，扩展困难；
- 缺乏可靠投递与离线补偿机制，导致消息丢失或顺序紊乱；
- 缺少鉴权与权限治理，管理操作不可追溯，存在安全与合规风险；
- 运维可观测性不足，难以定位故障与评估服务健康度。

因此，构建“统一接入 + 可靠性 + 安全治理 + 可观测运维”的消息网关与管理平台具有现实意义。

## 三、研究意义
### 1) 工程实践意义
将“消息接入、会话与队列、鉴权与 RBAC、审计、指标与健康度”集成为可运行系统，为机器人平台接入与运维提供参考实现。

### 2) 教学与科研意义
课题覆盖软件工程完整链路：需求分析、架构设计、接口规范、前后端实现、测试评估与文档沉淀，适合作为毕业设计实践题目。

## 四、国内外研究现状（简述）
业界普遍采用 API Gateway / BFF / 事件总线等模式解决多端接入与治理问题，配合可观测性（日志、指标、链路追踪）提升运维效率。机器人平台生态中也存在多种协议（如 OneBot）与不同的接入方式（WS/HTTP）。本课题聚焦在“面向特定机器人平台 AstrBot 的接入网关与管理平台”，强调工程化落地与运维可观测能力的集成实现。

## 五、研究目标与拟解决的关键问题
### 研究目标
- 实现双接入模式：WebSocket（实时会话）与 HTTP Integrations（业务系统调用）。
- 实现可靠性机制：按 user_id 的 FIFO 与并发隔离、离线队列与落盘、幂等键防重投递。
- 实现管理治理：Dual-token 鉴权、RBAC、审计日志与高危操作控制。
- 实现可观测性：指标快照与导出、健康度评分与解释、看板展示与运维入口。

### 关键问题
1. **消息路由与关联**：如何将外部 user_id 与 AstrBot 回复正确关联，并支持同步等待回复（request-reply）。
2. **可靠投递与顺序性**：离线情况下如何缓存、恢复投递，如何避免重试导致重复发送。
3. **安全与权限治理**：管理端与业务接入端如何区分鉴权体系，如何实现 RBAC 与审计闭环。
4. **可观测与可运维**：如何用可解释的规则模型输出“健康度”，并让前端看板可视化且可验证。

## 六、研究内容与系统设计要点
### 1) 系统总体架构
- 外部接入：
  - WS：浏览器/前端实时连接，发送消息、接收回复
  - HTTP：/api/integrations/* 提供事件投递与同步问答
- 内部适配：
  - Adapter 作为 WebSocket Client 连接 AstrBot
  - 将消息转换为 OneBot v11 私聊事件投递，并将 AstrBot action 的回复回传到对应 user_id
- 管理治理：
  - /api/auth/*：登录/刷新/登出（Dual-token）
  - /api/*：管理接口（RBAC + 审计）
- 可观测：
  - /api/metrics（JSON）与 /metrics（文本导出）
  - /api/metrics/health（score/level/reasons/model/signals）

### 2) 功能模块
1. 会话管理模块：在线/离线、队列长度、会话统计、踢下线与离线清理
2. 接入模块：events、request-reply、幂等键、PSK 鉴权（Integration Secret）
3. 鉴权与 RBAC：Access Token + Refresh Cookie；管理员/超级管理员
4. 审计与日志：关键操作审计；近期日志与 SSE 实时流
5. 指标与健康度：计数器/直方图分位、健康度评分规则与解释
6. 管理后台：仪表盘、分析看板、会话/日志/审计/设置等

## 七、技术方案与可行性分析
### 1) 技术选型
- 后端：Node.js + TypeScript + Express + ws
- 前端：Vue 3 + Element Plus + ECharts
- 文档：OpenAPI 3.0 + /docs 自动渲染

### 2) 可行性
- 技术成熟、生态完善；接口与模块边界清晰；系统可分阶段交付与验证
- 风险点与应对：
  - AstrBot 不可用/网络波动：自动重连与降级提示、健康度 reasons
  - 并发与顺序：按 user_id 排队与 request_id 关联；超时策略与错误码清晰
  - 安全：令牌有效期、httpOnly cookie、RBAC 与审计

## 八、研究方法与实施步骤
- 需求分析：用例/角色/数据流梳理，形成需求规格
- 架构设计：模块划分、接口规范、关键数据结构设计
- 迭代实现：先后端核心链路，再管理后台联调
- 测试评估：功能/稳定性/性能；故障场景注入（断连、超时、队列积压等）
- 文档沉淀：OpenAPI、部署说明、测试报告、论文撰写

## 九、预期成果与验收指标（建议）
### 1) 预期成果
- 可运行系统：后端服务 + 管理后台 + 文档与演示页面
- 论文：包含架构、关键实现、测试与评估
- 测试与报告：核心流程 smoke 测试、压测脚本与指标对比

### 2) 验收指标（示例）
- 鉴权与 RBAC：未授权访问拦截准确；高危操作仅 super_admin 可执行；审计完整
- 接入能力：events 投递成功率、幂等命中正确；request-reply 超时可控
- 可靠性：离线入队、上线补发正确；队列上限策略可验证
- 可观测：指标可查询；健康度评分与 reasons 可解释且可复现实验
- 前端：仪表盘与分析页能实时反映后端状态变化

## 十、进度计划（建议）
1. 第 1–2 周：调研与需求分析，完成开题与总体设计
2. 第 3–5 周：后端核心链路（接入/会话/鉴权/审计/指标）实现与测试
3. 第 6–7 周：管理后台实现与联调（仪表盘、分析、日志、审计、设置）
4. 第 8 周：完善可观测性、健康度模型与故障场景验证
5. 第 9–10 周：论文撰写、答辩材料与演示脚本

## 十一、参考文献（建议）
1. RFC 6455: The WebSocket Protocol
2. RFC 7519: JSON Web Token (JWT)
3. OpenAPI Specification 3.0
4. Prometheus Monitoring System 文档（指标类型与分位数概念）
5. OneBot v11 协议相关资料（消息事件与动作模型）
